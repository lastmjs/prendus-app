<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/webcomponentsjs/webcomponents-loader.js">
<link rel="import" href="../../node_modules/redux-store-element/redux-store.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../prendus-courses/prendus-courses.html">
<link rel="import" href="../prendus-course/prendus-course.html">
<link rel="import" href="../prendus-assignment/prendus-assignment.html">
<link rel="import" href="../prendus-learning-structure/prendus-learning-structure.html">
<link rel="import" href="../prendus-learning-structure/prendus-discipline.html">
<link rel="import" href="../prendus-learning-structure/prendus-subject.html">
<link rel="import" href="../prendus-learning-structure/prendus-concept.html">
<link rel="import" href="../../node_modules/prendus-question-elements/prendus-view-question.html">
<link rel="import" href="../../node_modules/prendus-question-elements/prendus-edit-question.html">
<link rel="import" href="../prendus-signup/prendus-signup.html">
<link rel="import" href="../prendus-login/prendus-login.html">
<link rel="import" href="../prendus-authenticate/prendus-authenticate.html">
<link rel="import" href="../prendus-ui/prendus-drop-down.html">
<link rel="import" href="../prendus-ui/prendus-styles.html">
<link rel="import" href="../prendus-open-source/prendus-open-source.html">
<link rel="import" href="../prendus-landing-page/prendus-landing-page.html">


<dom-module id="prendus-app">
    <template>
      <style include ="prendus-styles">
        #app-container {
  				display: flex;
  				flex-direction: column;
  				align-items: center;
  				position: relative;
          min-height: calc(100vh - 150px);
  			}
  			.app-window {
  				box-sizing: border-box;
  				margin: auto;
  				margin: 20px 50px;
  				max-width: 800px;
  				width: 100%;
  			}

        .landing{
          max-width: 100%;
          margin:0;
          padding:0;
        }

  			.loading-spinner {
  				position: fixed;
  				left: calc(50% - 30px);
  				bottom: calc(50% - 30px);
  				width: 60px;
  				height: 60px;
  			}
        .footer-items {
  	      width: 100%;
  	      display: flex;
  	      justify-content: space-between;
  	      align-items: center;
          font-size: 15px;
  	    }
  			@media (max-width: 768px) {
  				.app-window {
  					padding: 10px 20px;
  				}
  			}
      </style>
        <redux-store id="reduxStoreElement" root-reducer="[[rootReducer]]" on-statechange="stateChange" action="[[action]]"></redux-store>

        <!--TODO get rid of the two-way data binding, listen to events and integrate with Redux-->
        <!--TODO update app-location once this PR goes through: https://github.com/PolymerElements/iron-location/pull/83 -->
        <app-location id="appLocation" route="{{route}}" query-params="{{queryParams}}"></app-location>

        <app-route route="[[route]]" pattern="/" active="{{rootRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/signup" active="{{signupRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/login" active="{{loginRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/authenticate" active="{{authenticateRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/open-source" active="{{openSourceRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/course/create" data="{{createCourseRouteData}}" active="{{createCourseRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/course/:courseId/view" data="{{viewCourseRouteData}}" active="{{viewCourseRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/course/:courseId/edit" data="{{editCourseRouteData}}" active="{{editCourseRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/assignment/create" data="{{createAssignmentRouteData}}" active="{{createAssignmentRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/assignment/:assignmentId/view" data="{{viewAssignmentRouteData}}" active="{{viewAssignmentRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/assignment/:assignmentId/edit" data="{{editAssignmentRouteData}}" active="{{editAssignmentRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/learning-structure" data="{{learningStructureRouteData}}" active="{{learningStructureRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/discipline/create" data="{{createDisciplineRouteData}}" active="{{createDisciplineRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/discipline/:disciplineId/view" data="{{viewDisciplineRouteData}}" active="{{viewDisciplineRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/discipline/:disciplineId/edit" data="{{editDisciplineRouteData}}" active="{{editDisciplineRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/subject/create" data="{{createSubjectRouteData}}" active="{{createSubjectRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/subject/:subjectId/view" data="{{viewSubjectRouteData}}" active="{{viewSubjectRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/subject/:subjectId/edit" data="{{editSubjectRouteData}}" active="{{editSubjectRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/concept/create" data="{{createConceptRouteData}}" active="{{createConceptRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/concept/:conceptId/view" data="{{viewConceptRouteData}}" active="{{viewConceptRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/concept/:conceptId/edit" data="{{editConceptRouteData}}" active="{{editConceptRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/question/create" data="{{createQuestionRouteData}}" active="{{createQuestionRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/question/:questionId/view" data="{{viewQuestionRouteData}}" active="{{viewQuestionRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/question/:questionId/edit" data="{{editQuestionRouteData}}" active="{{editQuestionRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/question/:questionId/demo" data="{{editDemoQuestionRouteData}}" active="{{editDemoQuestionRouteActive}}"></app-route>

        <app-header id  ="prendus-navbar">
          <app-toolbar>
            <a id="home-link" href="/"><img id="logo" src="../../images/navbar-logo.png" alt="Prendus"></a>
            <dom-if if="[[user]]">
              <template>
                <div >
                  [[user.email]]
                  <a class="prendus-button prendus-button--recommended navbar-text" on-click="logout">Log out</a>
                </div>
              </template>
            </dom-if>
            <dom-if if="[[!user]]">
              <template>
                <a class="prendus-button prendus-button--recommended navbar-text" href="signup">Signup</a>
                <a class="prendus-button prendus-button--recommended navbar-text" href="login">Login</a>
              </template>
            </dom-if>
          <app-toolbar>
        </app-header>



        <iron-pages id="app-container" attr-for-selected="show" selected="[[getSelectedView(rootRouteActive, createCourseRouteActive, viewCourseRouteActive, editCourseRouteActive, createAssignmentRouteActive, viewAssignmentRouteActive, editAssignmentRouteActive, createDisciplineRouteActive, viewDisciplineRouteActive, editDisciplineRouteActive, createSubjectRouteActive, viewSubjectRouteActive, editSubjectRouteActive, createConceptRouteActive, viewConceptRouteActive, editConceptRouteActive, learningStructureRouteActive, signupRouteActive, loginRouteActive, authenticateRouteActive, viewQuestionRouteActive, createQuestionRouteActive, editQuestionRouteActive, editDemoQuestionRouteActive, openSourceRouteActive)]]">

            <prendus-landing-page  class="app-window landing" show="rootView"></prendus-landing-page>

            <prendus-open-source show="openSourceView"></prendus-open-source>

            <prendus-signup class="app-window" show="signupView" redirect-url="[[queryParams.redirectUrl]]"></prendus-signup>
            <prendus-login show="loginView" redirect-url="[[queryParams.redirectUrl]]"></prendus-login>
            <prendus-authenticate show="authenticateView" active="[[authenticateRouteActive]]"></prendus-authenticate>

            <div show="viewQuestionView" class="viewQuestionContainer">
                <div class="viewQuestionWrapper">
                    <prendus-view-question question-id="[[viewQuestionRouteData.questionId]]"></prendus-view-question>
                </div>
            </div>
            <prendus-edit-question show="createQuestionView" user="[[user]]" user-token="[[userToken]]"></prendus-edit-question>
            <prendus-edit-question show="editQuestionView" question-id="[[editQuestionRouteData.questionId]]" user="[[user]]" user-token="[[userToken]]"></prendus-edit-question>
            <prendus-edit-question show="editDemoQuestionView" question-id="[[editDemoQuestionRouteData.questionId]]" user="[[user]]" user-token="[[userToken]]" no-save></prendus-edit-question>

            <prendus-course class="app-window" show="createCourseView" course-id="[[createCourseRouteData.courseId]]" mode="create"></prendus-course>
            <prendus-course class="app-window" show="viewCourseView" course-id="[[viewCourseRouteData.courseId]]" mode="view"></prendus-course>
            <prendus-course class="app-window" show="editCourseView" course-id="[[editCourseRouteData.courseId]]" mode="edit"></prendus-course>

            <prendus-assignment class="app-window" show="createAssignmentView" assignment-id="[[createAssignmentRouteData.assignmentId]]" course-id="[[queryParams.courseId]]" mode="create"></prendus-assignment>
            <prendus-assignment class="app-window" show="viewAssignmentView" assignment-id="[[viewAssignmentRouteData.assignmentId]]" assignment-type="[[queryParams.assignmentType]]" mode="view"></prendus-assignment>
            <prendus-assignment class="app-window" show="editAssignmentView" assignment-id="[[editAssignmentRouteData.assignmentId]]" mode="edit"></prendus-assignment>

            <prendus-learning-structure show="learningStructureView" mode="view"></prendus-learning-structure>

            <prendus-discipline class="app-window" show="createDisciplineView" discipline-id="[[createDisciplineRouteData.disciplineId]]" mode="create"></prendus-discipline>
            <prendus-discipline class="app-window" show="viewDisciplineView" discipline-id="[[viewDisciplineRouteData.disciplineId]]" mode="view"></prendus-discipline>
            <prendus-discipline class="app-window" show="editDisciplineView" discipline-id="[[editDisciplineRouteData.disciplineId]]" mode="edit"></prendus-discipline>

            <prendus-subject class="app-window" show="createSubjectView" subject-id="[[createSubjectRouteData.subjectId]]" discipline-id="[[queryParams.disciplineId]]" mode="create"></prendus-subject>
            <prendus-subject class="app-window" show="viewSubjectView" subject-id="[[viewSubjectRouteData.subjectId]]" mode="view"></prendus-subject>
            <prendus-subject class="app-window" show="editSubjectView" subject-id="[[editSubjectRouteData.subjectId]]" mode="edit"></prendus-subject>

            <prendus-concept class="app-window" show="createConceptView" concept-id="[[createConceptRouteData.conceptId]]" subject-id="[[queryParams.subjectId]]" mode="create"></prendus-concept>
            <prendus-concept class="app-window" show="viewConceptView" concept-id="[[viewConceptRouteData.conceptId]]" mode="view"></prendus-concept>
            <prendus-concept class="app-window" show="editConceptView" concept-id="[[editConceptRouteData.conceptId]]" mode="edit"></prendus-concept>

        </iron-pages>
        <app-toolbar>
          <footer class="footer-items">
            <div>&copy; [[getYear()]]&nbsp;<span class="long-text">Prendus LLC</span></div>
            <a target="_blank" href="https://github.com/Prendus/content/blob/master/terms-of-use.md">Terms of Use</a>
            <a target="_blank" href="https://github.com/Prendus/content/blob/master/privacy-policy.md">Privacy Policy</a>
            <a href="/open-source">Open Source</a>
            <!-- <a href="/terms-of-service">Terms&nbsp;<span id="terms-of-service" class="long-text">of Service</span></a>
            <a href="/privacy-policy">Privacy&nbsp;<span id="privacy-policy" class="long-text">Policy</span></a>
            <a href="/open-source"><span id="open-source" class="long-text">Open Source</span></a> -->
          </footer>
        </app-toolbar>


    </template>

    <script src="prendus-app.ts"></script>
</dom-module>
