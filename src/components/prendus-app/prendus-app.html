<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../node_modules/redux-store-element/redux-store.html">
<!-- <link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../prendus-courses/prendus-courses.html">
<link rel="import" href="../prendus-course/prendus-course.html">
<link rel="import" href="../prendus-lesson/prendus-lesson.html">
<link rel="import" href="../prendus-assignment/prendus-assignment.html">
<link rel="import" href="../prendus-learning-structure/prendus-learning-structure.html">
<link rel="import" href="../prendus-learning-structure/prendus-discipline.html">
<link rel="import" href="../prendus-learning-structure/prendus-subject.html">
<link rel="import" href="../prendus-learning-structure/prendus-concept.html">
<link rel="import" href="../prendus-signup/prendus-signup.html">
<link rel="import" href="../prendus-login/prendus-login.html">
<link rel="import" href="../prendus-authenticate/prendus-authenticate.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html"> -->

<link rel="import" href="../prendus-view-question/prendus-view-question.html">

<dom-module id="prendus-app">
    <template>
        <redux-store id="reduxStoreElement" root-reducer="[[rootReducer]]" on-statechange="stateChange" action="[[action]]"></redux-store>

        <!--TODO get rid of the two-way data binding, listen to events and integrate with Redux-->
        <!--TODO update app-location once this PR goes through: https://github.com/PolymerElements/iron-location/pull/83 -->
        <app-location id="appLocation" route="{{route}}" query-params="{{queryParams}}"></app-location>

        <app-route route="[[route]]" pattern="/" active="{{rootRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/signup" active="{{signupRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/login" active="{{loginRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/authenticate" active="{{authenticateRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/course/create" data="{{createCourseRouteData}}" active="{{createCourseRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/course/:courseId/view" data="{{viewCourseRouteData}}" active="{{viewCourseRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/course/:courseId/edit" data="{{editCourseRouteData}}" active="{{editCourseRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/lesson/create" data="{{createLessonRouteData}}" active="{{createLessonRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/lesson/:lessonId/view" data="{{viewLessonRouteData}}" active="{{viewLessonRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/lesson/:lessonId/edit" data="{{editLessonRouteData}}" active="{{editLessonRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/assignment/create" data="{{createAssignmentRouteData}}" active="{{createAssignmentRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/assignment/:assignmentId/view" data="{{viewAssignmentRouteData}}" active="{{viewAssignmentRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/assignment/:assignmentId/edit" data="{{editAssignmentRouteData}}" active="{{editAssignmentRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/learning-structure" data="{{learningStructureRouteData}}" active="{{learningStructureRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/discipline/create" data="{{createDisciplineRouteData}}" active="{{createDisciplineRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/discipline/:disciplineId/view" data="{{viewDisciplineRouteData}}" active="{{viewDisciplineRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/discipline/:disciplineId/edit" data="{{editDisciplineRouteData}}" active="{{editDisciplineRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/subject/create" data="{{createSubjectRouteData}}" active="{{createSubjectRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/subject/:subjectId/view" data="{{viewSubjectRouteData}}" active="{{viewSubjectRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/subject/:subjectId/edit" data="{{editSubjectRouteData}}" active="{{editSubjectRouteActive}}"></app-route>

        <app-route route="[[route]]" pattern="/concept/create" data="{{createConceptRouteData}}" active="{{createConceptRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/concept/:conceptId/view" data="{{viewConceptRouteData}}" active="{{viewConceptRouteActive}}"></app-route>
        <app-route route="[[route]]" pattern="/concept/:conceptId/edit" data="{{editConceptRouteData}}" active="{{editConceptRouteActive}}"></app-route>

        <a href="/">Prendus</a>

        <dom-if if="[[user]]">
            <template>
                [[user.email]]
                <button on-click="logout">
                    Logout
                </button>
            </template>
        </dom-if>

        <dom-if if="[[!user]]">
          <template>
            <button>
                <a href="signup">Signup</a>
            </button>

            <button>
                <a href="login">Login</a>
            </button>
          </template>
        </dom-if>

        <br>

        <iron-pages attr-for-selected="show" selected="[[getSelectedView(rootRouteActive, createCourseRouteActive, viewCourseRouteActive, editCourseRouteActive, createLessonRouteActive, viewLessonRouteActive, editLessonRouteActive, createAssignmentRouteActive, viewAssignmentRouteActive, editAssignmentRouteActive, createDisciplineRouteActive, viewDisciplineRouteActive, editDisciplineRouteActive, createSubjectRouteActive, viewSubjectRouteActive, editSubjectRouteActive, createConceptRouteActive, viewConceptRouteActive, editConceptRouteActive, learningStructureRouteActive, signupRouteActive, loginRouteActive, authenticateRouteActive)]]">
            <prendus-courses show="rootView"></prendus-courses>

            <prendus-signup show="signupView" redirect-url="[[queryParams.redirectUrl]]"></prendus-signup>
            <prendus-login show="loginView" redirect-url="[[queryParams.redirectUrl]]" link-lti-account="[[queryParams.linkLtiAccount]]"></prendus-login>
            <prendus-authenticate show="authenticateView" redirect-url="[[queryParams.redirectUrl]]" link-lti-account="[[queryParams.linkLtiAccount]]" active="[[authenticateRouteActive]]"></prendus-authenticate>

            <prendus-course show="createCourseView" course-id="[[createCourseRouteData.courseId]]" mode="create"></prendus-course>
            <prendus-course show="viewCourseView" course-id="[[viewCourseRouteData.courseId]]" mode="view"></prendus-course>
            <prendus-course show="editCourseView" course-id="[[editCourseRouteData.courseId]]" mode="edit"></prendus-course>

            <prendus-lesson show="createLessonView" lesson-id="[[createLessonRouteData.lessonId]]" course-id="[[queryParams.courseId]]" mode="create"></prendus-lesson>
            <prendus-lesson show="viewLessonView" lesson-id="[[viewLessonRouteData.lessonId]]" mode="view"></prendus-lesson>
            <prendus-lesson show="editLessonView" lesson-id="[[editLessonRouteData.lessonId]]" mode="edit"></prendus-lesson>

            <prendus-assignment show="createAssignmentView" assignment-id="[[createAssignmentRouteData.lessonId]]" lesson-id="[[queryParams.lessonId]]" mode="create"></prendus-assignment>
            <prendus-assignment show="viewAssignmentView" assignment-id="[[viewAssignmentRouteData.lessonId]]" mode="view"></prendus-assignment>
            <prendus-assignment show="editAssignmentView" assignment-id="[[editAssignmentRouteData.lessonId]]" mode="edit"></prendus-assignment>

            <prendus-learning-structure show="learningStructureView" mode="view"></prendus-learning-structure>

            <prendus-discipline show="createDisciplineView" discipline-id="[[createDisciplineRouteData.disciplineId]]" mode="create"></prendus-discipline>
            <prendus-discipline show="viewDisciplineView" discipline-id="[[viewDisciplineRouteData.disciplineId]]" mode="view"></prendus-discipline>
            <prendus-discipline show="editDisciplineView" discipline-id="[[editDisciplineRouteData.disciplineId]]" mode="edit"></prendus-discipline>

            <prendus-subject show="createSubjectView" subject-id="[[createSubjectRouteData.subjectId]]" discipline-id="[[queryParams.disciplineId]]" mode="create"></prendus-subject>
            <prendus-subject show="viewSubjectView" subject-id="[[viewSubjectRouteData.subjectId]]" mode="view"></prendus-subject>
            <prendus-subject show="editSubjectView" subject-id="[[editSubjectRouteData.subjectId]]" mode="edit"></prendus-subject>

            <prendus-concept show="createConceptView" concept-id="[[createConceptRouteData.subjectId]]" subject-id="[[queryParams.disciplineId]]" mode="create"></prendus-subject>
            <prendus-concept show="viewConceptView" concept-id="[[viewConceptRouteData.subjectId]]" mode="view"></prendus-subject>
            <prendus-concept show="editConceptView" concept-id="[[editConceptRouteData.subjectId]]" mode="edit"></prendus-subject>

        </iron-pages>

        <prendus-view-question question-id="cj3q4zu4cckzg0178ax43cp6r"></prendus-view-question>
    </template>

    <script src="prendus-app.ts"></script>
</dom-module>
