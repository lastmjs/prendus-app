<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-autocomplete/paper-autocomplete.html">
<link rel="import" href="../../bower_components/paper-autocomplete/paper-autocomplete-suggestions.html">
<link rel="import" href="../../node_modules/redux-store-element/redux-store.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html" >
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html" >
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../prendus-ui/prendus-styles.html">
<link rel="import" href="../prendus-search/prendus-search.html">
<link rel="import" href="../prendus-institutions/prendus-create-institution.html">


<dom-module id="prendus-signup">
    <template>
        <style include="prendus-styles">
        :host {
          width: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        #sign-up-container {
          width: 100%;
          max-width: 400px;
          padding: 3vh;
        }
        .giveMeSomeSpace{
          margin-top: 5vh;
        }
        #addInstitution{
          color: blue;
          cursor: pointer;
        }
        #create-institution-modal{
          width: 33%;
          min-width: 300px;
        }
        paper-autocomplete-suggestions{
          --suggestions-item
        }
        </style>
        <redux-store id="reduxStoreElement" action="[[action]]" on-statechange="stateChange"></redux-store>
        <dom-if if="[[loaded]]">
          <template>
            <paper-card id="sign-up-container">
              <h1>Sign up</h1>
              <form on-keydown="createUserOnEnter">
                <paper-input id="email" name="email" label="Email" required on-focusout="hardValidateEmail" on-keyup="validateEmail" pattern="^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$" error-message="Please enter a valid email address."></paper-input>
                <paper-input id="password" name="password" label="Password" type="password" required  minlength="6" on-focusout="hardValidatePassword" on-keyup="validatePassword" error-message="Please enter a password with at least 6 characters."></paper-input>
                <paper-input id="confirm-password" name="confirm-password" label="Confirm Password" type="password" required minlength="6" on-focusout="hardValidateConfirmedPassword" on-keyup="validateConfirmedPassword" error-message="Passwords do not match."></paper-input>
                <!-- <paper-autocomplete id="institution" name="institution" label="Institution" on-keydown="findInstitution" value="[[institution.name]]" no-label-float source="[[institutions]]"></paper-autocomplete> -->
                <!-- If the above autocomplete doesn't work, use this. -->
                <div class="autocomplete-wrapper">
                  <paper-input id="institution" name="institution" label="Institution" on-keydown="findInstitution" value="[[institution.name]]"></paper-input>
                  <paper-autocomplete-suggestions for="institution" source="[[institutions]]" on-autocomplete-selected="institutionAutoSelected"></paper-autocomplete-suggestions>
                </div>
                <prendus-search search-index="Institutions" search-parameter="[[institutionPartialName]]" attributes-to-retrieve="[[attributesToRetrieve]]" on-result="loadInstitutions"></prendus-search>
              </form>
              <span>Don't see your institution? <span id="addInstitution" on-click="openCreateInstitutionModal">Add your Institution</span>
              <div class="giveMeSomeSpace">By clicking the Signup button below, I agree to the <a href="https://github.com/Prendus/content/blob/master/terms-of-use.md" target="_blank">Terms of Use</a> and the <a href="https://github.com/Prendus/content/blob/master/privacy-policy.md" target="_blank">Privacy Policy</a></div>
            <div>
              <button class="giveMeSomeSpace prendus-button prendus-button--recommended" disabled="[[!signupButtonEnabled]]" on-click="signupClick">Submit</button>
            </div>
            </paper-card>
            <paper-dialog id="create-institution-modal" modal opened="[[createInstitutionModalOpen]]">
              <!-- Wrapped in a div solely for stylistic issues -->
              <div>
                <prendus-create-institution on-institution-created="setInstitution" on-cancel-dialog="closeCreateInstitutionModal"></prendus-create-institution>
              </div>
            </paper-dialog>
          </template>
        </dom-if>

        <dom-if if="[[!loaded]]">
            <template>
                Loading...
            </template>
        </dom-if>
    </template>

    <script type="module" src="prendus-signup.ts"></script>
</dom-module>
