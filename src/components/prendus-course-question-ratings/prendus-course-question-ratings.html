<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../node_modules/redux-store-element/redux-store.html">
<link rel="import" href="../prendus-ui/prendus-styles.html">
<link rel="import" href="../prendus-stacked-bar/prendus-stacked-bar.html">

<dom-module id="prendus-course-question-ratings">

  <template>

    <style include="prendus-styles">
      h2 {
        margin-bottom: 20px;
      }

      #questions {
        margin-top: 10px;
        border-bottom: 1px solid;
      }

      #table-header {
        background: var(--prendus-primary-color);
        color: white;
        border-radius: 15px 15px 0 0;
        border: none;
        align-items: center;
      }

      #table-header .table-cell {
        border: none;
        font-size: 14px;
      }

      .sortable {
        cursor: pointer;
      }

      .sortable:hover, .sortable:focus {
        text-decoration: underline;
      }

      .question-row {
        display: grid;
        grid-auto-rows: 4vw;
        grid-template-columns: 5fr; /* 3fr;*/
        grid-auto-columns: 1fr;
        grid-auto-flow: column;
        border-left: 1px solid;
      }

      .question-row .table-cell {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5%;
        border-right: 1px solid;
        border-bottom: 1px solid;
        overflow: hidden;
      }

      .question-meta {
        justify-content: normal !important;
      }

      [hidden] {
        display: none;
      }

    </style>
    <redux-store id="reduxStoreElement" action="[[action]]" on-statechange="stateChange"></redux-store>
    <div>
      <h2 id="question-rating-table-header">Questions: [[course.title]]</h2>
      <label for="assignmentId">Assignment</label>
      <select id="assignmentId" on-change="_assignmentIdChanged">
        <option value="ALL">All</option>
        <!-- TODO For some reason the <dom-repeat> element does not play nice inside select boxes -->
        <template is="dom-repeat" items="[[course.assignments]]">
          <option value="[[item.id]]">[[item.title]]</option>
        </template>
      </select>
      <label for="conceptId">Concept</label>
      <select id="conceptId" on-change="_conceptIdChanged">
        <option value="ALL">All</option>
          <template is="dom-repeat" items="[[_concepts(course.assignments)]]">
            <option value="[[item.id]]">[[item.title]]</option>
          </template>
      </select>
      <div id="questions" role="grid" aria-readonly="true" aria-labelledby="question-rating-table-header">
        <div id="table-header" class="question-row" role="row">
          <div class="table-cell column-header question-meta" scope="col" role="columnheader" aria-sort="none">Question</div>
          <!--div id="Student" class="table-cell column-header" scope="col" role="columnheader" aria-sort="none"><span class="sortable" on-click="_toggleSort" on-keydown="_checkToggleSort" role="button" tabindex="0">Student</span></div-->
          <dom-repeat items="[[categories]]" hidden>
            <template>
              <div class="column-header table-cell" scope="col" role="columnheader" aria-sort="none"><span class="sortable" on-click="_toggleSort" role="button" on-keydown="_checkToggleSort" tabindex="0">[[item]]</span></div>
            </template>
          </dom-repeat>
          <div id="Overall" class="table-cell column-header" scope="col" role="columnheader" aria-sort="descending"><span class="sortable" on-click="_toggleSort" on-keydown="_checkToggleSort" role="button" tabindex="0">Overall</span></div>
        </div>
        <dom-repeat items="[[questionStats]]" filter="[[_makeFilter(assignmentId, conceptId)]]" sort="[[_makeSorter(sortField, sortAsc)]]" hidden>
          <template>
            <div class="question-row" role="row">
              <div class="table-cell question-meta" role="rowheader">[[_questionOnly(item.text)]]</div>
              <!--div class="table-cell">[[item.student]]</div-->
              <dom-repeat items="[[categories]]" as="category" hidden>
                <template>
                  <div class="table-cell" role="gridcell"><prendus-stacked-bar label="ratings" data="[[_barStats(item.stats, category)]]"></prendus-stacked-bar></div>
                </template>
              </dom-repeat>
              <div class="table-cell">[[item.overall]]</div>
            </div>
          </template>
        </dom-repeat>
      </div>
    </div>

  </template>

  <script type="module" src="prendus-course-question-ratings.ts"></script>
</dom-module>
