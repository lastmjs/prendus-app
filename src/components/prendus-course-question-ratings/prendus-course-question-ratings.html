<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../node_modules/redux-store-element/redux-store.html">
<link rel="import" href="../prendus-ui/prendus-styles.html">

<dom-module id="prendus-course-question-ratings">

  <template>

    <style include="prendus-styles">
      h2 {
        margin-bottom: 20px;
      }

      #questions {
        margin-top: 10px;
        border-bottom: 1px solid;
      }

      #table-header {
        height: 40px;
        background: var(--prendus-primary-color);
        color: white;
        padding: 10px;
        border-radius: 15px 15px 0 0;
        border: none;
        align-items: baseline;
      }

      #table-header .table-cell {
        border: none;
      }

      .column-header {
        cursor: pointer;
      }

      .column-header:hover {
        text-decoration: underline;
      }

      .question-row {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        grid-auto-rows: minmax(100px, auto);
        border-left: 1px solid;
      }

      .question-row .table-cell {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5%;
        border-right: 1px solid;
        border-bottom: 1px solid;
      }

      .question-row .column-header:first-child {
        justify-content: normal;
      }

      .question-text {
        grid-column: span 2;
        grid-row: 1;
      }

      .question-accuracy {
        grid-column: 3;
        grid-row: 1;
      }

      .question-quality {
        grid-column: 4;
        grid-row: 1;
      }

      .question-difficulty {
        grid-column: 5;
        grid-row: 1;
      }

      .question-overall {
        grid-column: 6;
        grid-row: 1;
      }
    </style>
    <redux-store id="reduxStoreElement" action="[[action]]" on-statechange="stateChange"></redux-store>
    <div>
      <h2>Course Questions</h2>
      <label for="assignmentId">Assignment</label>
      <select id="assignmentId" on-change="_assignmentIdChanged">
        <option value="ALL">All</option>
        <!-- TODO For some reason the <dom-repeat> element does not play nice inside select boxes -->
        <template is="dom-repeat" items="[[assignments]]">
          <option value="[[item.id]]">[[item.title]]</option>
        </template>
      </select>
      <label for="conceptId">Concept</label>
      <select id="conceptId" on-change="_conceptIdChanged">
        <option value="ALL">All</option>
          <template is="dom-repeat" items="[[_concepts(assignments)]]">
            <option value="[[item.id]]">[[item.title]]</option>
          </template>
      </select>
      <div id="questions">
        <div id="table-header" class="question-row">
          <div class="table-cell question-text">Question</div>
          <div class="column-header table-cell question-accuracy"><span class="column-header" on-click="_toggleSort">Accuracy</span></div>
          <div class="column-header table-cell question-quality"><span class="column-header" on-click="_toggleSort">Quality</span></div>
          <div class="column-header table-cell question-difficulty"><span class="column-header" on-click="_toggleSort">Difficulty</span></div>
          <div class="column-header table-cell question-overall sorted"><span class="column-header" on-click="_toggleSort">Overall</span></div>
        </div>
        <dom-repeat items="[[questionStats]]" filter="[[_makeFilter(assignmentId, conceptId)]]" sort="[[_makeSorter(sortField, sortAsc)]]">
          <template>
            <div class="question-row">
              <div class="table-cell question-text">[[_questionOnly(item.text)]]</div>
              <div class="table-cell question-accuracy">[[item.accuracy]]</div>
              <div class="table-cell question-quality">[[item.quality]]</div>
              <div class="table-cell question-difficulty">[[item.difficulty]]</div>
              <div class="table-cell question-overall">[[item.overall]]</div>
            </div>
          </template>
        </dom-repeat>
      </div>
    </div>

  </template>

  <script src="prendus-course-question-ratings.ts"></script>
</dom-module>
